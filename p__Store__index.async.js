"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[445],{14422:function(se,b,e){e.d(b,{DE:function(){return Y},Qt:function(){return M},Yc:function(){return v},uV:function(){return N}});var Y="https://three-statices.oss-cn-hangzhou.aliyuncs.com/",v=function(R){return R.PROMOSE_ERROR_MSG="\u64CD\u4F5C\u5931\u8D25",R.PROMOSE_SUCCESS_MSG="\u64CD\u4F5C\u6210\u529F",R.PROMOSE_ERROR_DELEETE_MSG="\u64CD\u4F5C\u6210\u529F",R.PROMOSE_ERROR_GETBYID_MSG="\u6807\u8BC6\u4E0D\u5B58\u5728",R.PROMOSE_ERROR_ISHAVE_MSG="\u6570\u636E\u4E0D\u5B58\u5728",R}({}),N=[{label:"\u9910\u996E",value:"floor"},{label:"\u5A31\u4E50",value:"game"},{label:"\u670D\u88C5",value:"clothing"},{label:"\u6559\u80B2",value:"education"},{label:"\u4EBA\u5DE5\u667A\u80FD",value:"algo"},{label:"\u5176\u4ED6",value:"other"}],M=[{name:"F1",url:"floor-map/%E8%A5%BF%E5%8D%95%E5%A4%A7%E6%82%A6%E5%9F%8E/F1.svg"}]},52458:function(se,b,e){e.r(b),e.d(b,{default:function(){return Se}});var Y=e(5574),v=e.n(Y),N=e(32774),M=e(90930),R=e(96638),F=e(577),L=e(27494),q=e(63620),_=e(98086),U=e(5062),K=e(67294),T=e(80854),Z={floorList:"floorList___N4iHi",active:"active___Ryykx",threeMain:"threeMain___u9czE"},ee=e(15009),O=e.n(ee),D=e(99289),m=e.n(D),i=e(99477),te=e(69365),ae=e(79471),ne=new i.Pa4(500,1e3,500),w,I,g,s,t,r,a,o,E=function(){var f=m()(O()().mark(function u(l){var d;return O()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:w=new i.xsS,w.add(new i.y8_),l&&(I=new i.CP7({canvas:l,alpha:!0,powerPreference:"high-performance"}),I.shadowMap.enabled=!0,I.shadowMap.needsUpdate=!0,I.shadowMap.autoUpdate=!0),s=new ae.lX,s.setSize(l.offsetWidth,l.offsetHeight),s.domElement.classList.add("css3d"),I.setSize(l.offsetWidth,l.offsetHeight),o=new i.cPb(45,l.offsetWidth/l.offsetHeight,.2,2e6),o.position.copy(ne),d=new i.Pa4,t=new te.z(o,I.domElement),t.addEventListener("start",function(){d.copy(o.position)}),t.addEventListener("end",function(){}),t.addEventListener("change",function(){}),n();case 15:case"end":return c.stop()}},u)}));return function(l){return f.apply(this,arguments)}}(),n=function(){r=new i.Mig(7368816),a=new i.Ox3(16777215,4),a.position.set(1181.4843537287065,1580.039682987524,1809.053759094986),a.castShadow=!0;var u=140;a.shadow.camera.left=-u,a.shadow.camera.right=u,a.shadow.camera.top=u,a.shadow.camera.bottom=-u,a.shadow.camera.near=2,a.shadow.camera.far=10,a.shadow.mapSize.x=102,a.shadow.mapSize.y=102,w.add(a),w.add(r)},p=e(64599),B=e.n(p),J=e(81367),P=e(61411),$=e(77836),ie=new P.y,ce=new i.dpR,fe=new $.E,de=new J.u;function Ee(f,u){return new Promise(function(l,d){ie.load(f,function(h){l(h)},function(h){u&&u(h)})})}function Re(f){return new Promise(function(u,l){new OBJLoader().load(f,function(d){u(d)})})}function pe(f){return new Promise(function(u,l){ce.load(f,function(d){u(d)})})}function Pe(f){return new Promise(function(u,l){fe.load(f,function(d){u(d)})})}function Oe(f,u){return new Promise(function(l,d){new MTLLoader().load(u,function(h){h.preload(),new OBJLoader().setMaterials(h).load(f,function(c){l(c)})})})}function ve(f){return new Promise(function(u,l){de.load(f,function(d){u(d)})})}var he=function(){var f=m()(O()().mark(function u(l){var d,h,c,j,W,G,X,A,Q,k,H,V;return O()().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return x.next=2,ve(l);case 2:d=x.sent,h=B()(d.paths);try{for(h.s();!(c=h.n()).done;){j=c.value,W=J.u.createShapes(j),G=B()(W);try{for(G.s();!(X=G.n()).done;)A=X.value,Q={steps:2,depth:16,bevelEnabled:!0,bevelThickness:1,bevelSize:1,bevelOffset:0,bevelSegments:1},k=new i.O7d(A,Q),H=new i.vBJ({color:65280}),V=new i.Kj0(k,H),w.add(V)}catch(z){G.e(z)}finally{G.f()}}}catch(z){h.e(z)}finally{h.f()}case 5:case"end":return x.stop()}},u)}));return function(l){return f.apply(this,arguments)}}(),re=e(14422),S=e(85893),me=function(){var u,l=(0,T.useParams)(),d=(0,R.Z)({floorInfo:{},floorList:[],floorId:""}),h=v()(d,2),c=h[0],j=h[1],W=(0,F.Z)(N.BG,{manual:!0,onSuccess:function(y){y.success&&(j({floorInfo:y.data}),he(re.DE+y.data.url))}}),G=W.run;(0,K.useEffect)(function(){G({floorId:c.floorId||""})},[c.floorId]),(0,F.Z)(N.jl,{onSuccess:function(y){if(y.success){if(l.id&&l.id!==":id")j({floorId:l.id});else{var oe;j({floorId:(oe=y.data[0])===null||oe===void 0?void 0:oe.floorId})}console.log("res.data1111",y.data,re.DE),j({floorList:y.data.sort(function(ue,le){return ue.floorIndex&&le.floorIndex&&ue.floorIndex-le.floorIndex})})}}});var X=function(y){y&&c.floorId!==y&&j({floorId:y})},A=(0,K.useRef)(null);(0,K.useEffect)(function(){A.current&&(E(A.current),I.setAnimationLoop(Q))},[]);var Q=function(){I.render(w,o)},k=(0,R.Z)({open:!1,title:"\u65B0\u589E\u5E97\u94FA",isEdit:!1,editId:"",storeInfo:{}}),H=v()(k,2),V=H[0],ye=H[1],x=L.Z.useForm(),z=v()(x,1),ge=z[0];return(0,S.jsxs)(M._z,{title:(u=c.floorInfo)===null||u===void 0?void 0:u.name,ghost:!0,children:[(0,S.jsx)("ul",{className:Z.floorList,children:(c.floorList||[]).map(function(C){return(0,S.jsx)("li",{onClick:function(){return X(C.floorId)},className:"".concat(c.floorId===C.floorId?Z.active:""),children:(0,S.jsx)("span",{children:C.name})},C.floorId)})}),(0,S.jsx)("canvas",{className:Z.threeMain,ref:A}),(0,S.jsx)(q.Z,{open:V.open,title:V.title,children:(0,S.jsxs)(L.Z,{form:ge,children:[(0,S.jsx)(L.Z.Item,{label:"\u540D\u79F0",name:"name",required:!0,children:(0,S.jsx)(_.Z,{})}),(0,S.jsx)(L.Z.Item,{label:"\u6240\u5C5E\u697C\u5C42",name:"floorId",initialValue:c.floorId,children:(0,S.jsx)(U.Z,{options:c.floorList,disabled:!0,fieldNames:{label:"name",value:"floorId"}})}),(0,S.jsx)(L.Z.Item,{label:"\u4E1A\u6001",name:"type",initialValue:c.floorId,children:(0,S.jsx)(U.Z,{options:re.uV})})]})})]})},Se=me},32774:function(se,b,e){e.d(b,{wA:function(){return ae},jl:function(){return I},BG:function(){return te},RT:function(){return w},TW:function(){return ne}});var Y=e(15009),v=e.n(Y),N=e(99289),M=e.n(N),R=e(97857),F=e.n(R),L=e(12444),q=e.n(L),_=e(72004),U=e.n(_),K=e(9783),T=e.n(K),Z=function(){function g(s){var t=this,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"id";q()(this,g),T()(this,"databaseName",void 0),T()(this,"db",void 0),T()(this,"isOpen",!1),T()(this,"keyPath",void 0),this.databaseName=s,this.keyPath=r;var a=window.indexedDB.open(this.databaseName);a.onerror=function(){console.log("\u6570\u636E\u5E93\u6253\u5F00\u62A5\u9519"),t.isOpen=!1},a.onsuccess=function(){t.db=a.result,console.log("\u6570\u636E\u5E93\u6253\u5F00\u6210\u529F"),t.isOpen=!0},a.onupgradeneeded=function(o){t.db=o.target.result,t.db.objectStoreNames.contains(t.databaseName)||t.db.createObjectStore(t.databaseName,{keyPath:t.keyPath})}}return U()(g,[{key:"saveDataByKeyPath",value:function(){var s=M()(v()().mark(function r(a,o){var E,n,p,B;return v()().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return E=JSON.stringify(o),n={data:E},n[this.keyPath]=a,P.next=5,this.isHave(a);case 5:p=P.sent,B=this.db.transaction([this.databaseName],"readwrite").objectStore(this.databaseName),p?B.put(n):B.add(n);case 8:case"end":return P.stop()}},r,this)}));function t(r,a){return s.apply(this,arguments)}return t}()},{key:"isHave",value:function(t){var r=this;return new Promise(function(a){var o=r.db.transaction(r.databaseName).objectStore(r.databaseName);o.openCursor().onsuccess=function(E){var n=E.target.result;console.log("cursor",n,t),a(n&&(n==null?void 0:n.primaryKey)===t)}})}},{key:"getAllData",value:function(){var t=this;return new Promise(function(r){var a=[],o=t.db.transaction(t.databaseName).objectStore(t.databaseName);o.openCursor().onsuccess=function(E){var n=E.target.result;if(n){var p=n.value;a.push(JSON.parse(p.data)),n.continue()}else r(a)}})}},{key:"getDataByKeyPath",value:function(t){var r=this;return new Promise(function(a){var o=r.db.transaction([r.databaseName]).objectStore(r.databaseName).get(t);o.onsuccess=function(){console.log("request",o),o!=null&&o.result?a(o==null?void 0:o.result):a(null)}})}},{key:"removeDataByKeyPath",value:function(t){var r=this;return new Promise(function(a){var o=r.db.transaction([r.databaseName],"readwrite").objectStore(r.databaseName).delete(t);o.onsuccess=function(){a(!0)}})}}]),g}(),ee=e(57632),O=function(s,t){return{success:!0,msg:t||"",data:s}},D=function(s){return{success:!1,msg:s||"",data:null}},m=e(14422),i=new Z("floorData","floorId"),te=function(s){return new Promise(function(t,r){s.floorId?i.getDataByKeyPath(s.floorId).then(function(a){t(a?O(JSON.parse(a.data)):D(m.Yc.PROMOSE_ERROR_GETBYID_MSG))}):t(D(m.Yc.PROMOSE_ERROR_GETBYID_MSG))})},ae=function(s){return new Promise(function(t,r){var a=(0,ee.Z)();s.name!==void 0&&s.floorIndex!==void 0&&s.url!==void 0?(i.saveDataByKeyPath(a,F()(F()({},s),{},{floorId:a})),t(O({floorId:a},m.Yc.PROMOSE_SUCCESS_MSG))):t(D(m.Yc.PROMOSE_ERROR_MSG))})},ne=function(){var g=M()(v()().mark(function s(t,r){return v()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",new Promise(function(){var E=M()(v()().mark(function n(p,B){return v()().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:try{i.getDataByKeyPath(t).then(function($){i.saveDataByKeyPath(t,F()(F()(F()({},JSON.parse($.data)),r),{},{floorId:t})),p(O(void 0,m.Yc.PROMOSE_SUCCESS_MSG))})}catch($){p(D(m.Yc.PROMOSE_ERROR_MSG))}case 1:case"end":return P.stop()}},n)}));return function(n,p){return E.apply(this,arguments)}}()));case 1:case"end":return o.stop()}},s)}));return function(t,r){return g.apply(this,arguments)}}(),w=function(s){return new Promise(function(){var t=M()(v()().mark(function r(a,o){return v()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:s?i.removeDataByKeyPath(s).then(function(){a(O(void 0,m.Yc.PROMOSE_SUCCESS_MSG))}).catch(function(p){a(D(m.Yc.PROMOSE_ERROR_DELEETE_MSG))}):a(D(m.Yc.PROMOSE_ERROR_ISHAVE_MSG));case 1:case"end":return n.stop()}},r)}));return function(r,a){return t.apply(this,arguments)}}())},I=function(){return new Promise(function(){var s=M()(v()().mark(function t(r,a){var o;return v()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,i.getAllData();case 3:o=n.sent,r(O(o)),n.next=10;break;case 7:n.prev=7,n.t0=n.catch(0),r(D(m.Yc.PROMOSE_ERROR_MSG));case 10:case"end":return n.stop()}},t,null,[[0,7]])}));return function(t,r){return s.apply(this,arguments)}}())}}}]);
