"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[445],{14422:function(oe,x,e){e.d(x,{Qt:function(){return b},Yc:function(){return A},uV:function(){return v}});var A=function(m){return m.PROMOSE_ERROR_MSG="\u64CD\u4F5C\u5931\u8D25",m.PROMOSE_SUCCESS_MSG="\u64CD\u4F5C\u6210\u529F",m.PROMOSE_ERROR_DELEETE_MSG="\u64CD\u4F5C\u6210\u529F",m.PROMOSE_ERROR_GETBYID_MSG="\u6807\u8BC6\u4E0D\u5B58\u5728",m.PROMOSE_ERROR_ISHAVE_MSG="\u6570\u636E\u4E0D\u5B58\u5728",m}({}),v=[{label:"\u9910\u996E",value:"floor"},{label:"\u5A31\u4E50",value:"game"},{label:"\u670D\u88C5",value:"clothing"},{label:"\u6559\u80B2",value:"education"},{label:"\u4EBA\u5DE5\u667A\u80FD",value:"algo"},{label:"\u5176\u4ED6",value:"other"}],b=[{name:"F1",url:"floor-map/%E8%A5%BF%E5%8D%95%E5%A4%A7%E6%82%A6%E5%9F%8E/F1.svg"}]},52458:function(oe,x,e){e.r(x),e.d(x,{default:function(){return Se}});var A=e(5574),v=e.n(A),b=e(32774),m=e(90930),V=e(96638),F=e(577),C=e(27494),q=e(63620),_=e(98086),J=e(5062),Y=e(67294),N=e(80854),K={floorList:"floorList___N4iHi",active:"active___Ryykx",threeMain:"threeMain___u9czE"},ee=e(15009),O=e.n(ee),M=e(99289),S=e.n(M),i=e(99477),te=e(69365),ae=e(79471),ne=new i.Pa4(500,1e3,500),w,I,E,s,t,r,a,o,R=function(){var f=S()(O()().mark(function u(l){var d;return O()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:w=new i.xsS,w.add(new i.y8_),l&&(I=new i.CP7({canvas:l,alpha:!0,powerPreference:"high-performance"}),I.shadowMap.enabled=!0,I.shadowMap.needsUpdate=!0,I.shadowMap.autoUpdate=!0),s=new ae.lX,s.setSize(l.offsetWidth,l.offsetHeight),s.domElement.classList.add("css3d"),I.setSize(l.offsetWidth,l.offsetHeight),o=new i.cPb(45,l.offsetWidth/l.offsetHeight,.2,2e6),o.position.copy(ne),d=new i.Pa4,t=new te.z(o,I.domElement),t.addEventListener("start",function(){d.copy(o.position)}),t.addEventListener("end",function(){}),t.addEventListener("change",function(){}),n();case 15:case"end":return c.stop()}},u)}));return function(l){return f.apply(this,arguments)}}(),n=function(){r=new i.Mig(7368816),a=new i.Ox3(16777215,4),a.position.set(1181.4843537287065,1580.039682987524,1809.053759094986),a.castShadow=!0;var u=140;a.shadow.camera.left=-u,a.shadow.camera.right=u,a.shadow.camera.top=u,a.shadow.camera.bottom=-u,a.shadow.camera.near=2,a.shadow.camera.far=10,a.shadow.mapSize.x=102,a.shadow.mapSize.y=102,w.add(a),w.add(r)},p=e(64599),B=e.n(p),U=e(81367),P=e(61411),$=e(77836),le=new P.y,ie=new i.dpR,ce=new $.E,fe=new U.u;function Ee(f,u){return new Promise(function(l,d){le.load(f,function(h){l(h)},function(h){u&&u(h)})})}function Re(f){return new Promise(function(u,l){new OBJLoader().load(f,function(d){u(d)})})}function pe(f){return new Promise(function(u,l){ie.load(f,function(d){u(d)})})}function Pe(f){return new Promise(function(u,l){ce.load(f,function(d){u(d)})})}function Oe(f,u){return new Promise(function(l,d){new MTLLoader().load(u,function(h){h.preload(),new OBJLoader().setMaterials(h).load(f,function(c){l(c)})})})}function de(f){return new Promise(function(u,l){fe.load(f,function(d){u(d)})})}var ve=function(){var f=S()(O()().mark(function u(l){var d,h,c,j,W,L,X,T,Q,k,Z,H;return O()().wrap(function(G){for(;;)switch(G.prev=G.next){case 0:return G.next=2,de(l);case 2:d=G.sent,h=B()(d.paths);try{for(h.s();!(c=h.n()).done;){j=c.value,W=U.u.createShapes(j),L=B()(W);try{for(L.s();!(X=L.n()).done;)T=X.value,Q={steps:2,depth:16,bevelEnabled:!0,bevelThickness:1,bevelSize:1,bevelOffset:0,bevelSegments:1},k=new i.O7d(T,Q),Z=new i.vBJ({color:65280}),H=new i.Kj0(k,Z),w.add(H)}catch(z){L.e(z)}finally{L.f()}}}catch(z){h.e(z)}finally{h.f()}case 5:case"end":return G.stop()}},u)}));return function(l){return f.apply(this,arguments)}}(),he=e(14422),y=e(85893),me=function(){var u,l=(0,N.useParams)(),d=(0,V.Z)({floorInfo:{},floorList:[],floorId:""}),h=v()(d,2),c=h[0],j=h[1],W=(0,F.Z)(b.BG,{manual:!0,onSuccess:function(g){g.success&&(j({floorInfo:g.data}),ve("https://article-local-storage.oss-cn-hangzhou.aliyuncs.com/"+g.data.url))}}),L=W.run;(0,Y.useEffect)(function(){L({floorId:c.floorId||""})},[c.floorId]),(0,F.Z)(b.jl,{onSuccess:function(g){if(g.success){if(l.id&&l.id!==":id")j({floorId:l.id});else{var re;j({floorId:(re=g.data[0])===null||re===void 0?void 0:re.floorId})}console.log("res.data",g.data,"https://article-local-storage.oss-cn-hangzhou.aliyuncs.com/"),j({floorList:g.data.sort(function(se,ue){return se.floorIndex&&ue.floorIndex&&se.floorIndex-ue.floorIndex})})}}});var X=function(g){g&&c.floorId!==g&&j({floorId:g})},T=(0,Y.useRef)(null);(0,Y.useEffect)(function(){T.current&&(R(T.current),I.setAnimationLoop(Q))},[]);var Q=function(){I.render(w,o)},k=(0,V.Z)({open:!1,title:"\u65B0\u589E\u5E97\u94FA",isEdit:!1,editId:"",storeInfo:{}}),Z=v()(k,2),H=Z[0],ye=Z[1],G=C.Z.useForm(),z=v()(G,1),ge=z[0];return(0,y.jsxs)(m._z,{title:(u=c.floorInfo)===null||u===void 0?void 0:u.name,ghost:!0,children:[(0,y.jsx)("ul",{className:K.floorList,children:(c.floorList||[]).map(function(D){return(0,y.jsx)("li",{onClick:function(){return X(D.floorId)},className:"".concat(c.floorId===D.floorId?K.active:""),children:(0,y.jsx)("span",{children:D.name})},D.floorId)})}),(0,y.jsx)("canvas",{className:K.threeMain,ref:T}),(0,y.jsx)(q.Z,{open:H.open,title:H.title,children:(0,y.jsxs)(C.Z,{form:ge,children:[(0,y.jsx)(C.Z.Item,{label:"\u540D\u79F0",name:"name",required:!0,children:(0,y.jsx)(_.Z,{})}),(0,y.jsx)(C.Z.Item,{label:"\u6240\u5C5E\u697C\u5C42",name:"floorId",initialValue:c.floorId,children:(0,y.jsx)(J.Z,{options:c.floorList,disabled:!0,fieldNames:{label:"name",value:"floorId"}})}),(0,y.jsx)(C.Z.Item,{label:"\u4E1A\u6001",name:"type",initialValue:c.floorId,children:(0,y.jsx)(J.Z,{options:he.uV})})]})})]})},Se=me},32774:function(oe,x,e){e.d(x,{wA:function(){return ae},jl:function(){return I},BG:function(){return te},RT:function(){return w},TW:function(){return ne}});var A=e(15009),v=e.n(A),b=e(99289),m=e.n(b),V=e(97857),F=e.n(V),C=e(12444),q=e.n(C),_=e(72004),J=e.n(_),Y=e(9783),N=e.n(Y),K=function(){function E(s){var t=this,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"id";q()(this,E),N()(this,"databaseName",void 0),N()(this,"db",void 0),N()(this,"isOpen",!1),N()(this,"keyPath",void 0),this.databaseName=s,this.keyPath=r;var a=window.indexedDB.open(this.databaseName);a.onerror=function(){console.log("\u6570\u636E\u5E93\u6253\u5F00\u62A5\u9519"),t.isOpen=!1},a.onsuccess=function(){t.db=a.result,console.log("\u6570\u636E\u5E93\u6253\u5F00\u6210\u529F"),t.isOpen=!0},a.onupgradeneeded=function(o){t.db=o.target.result,t.db.objectStoreNames.contains(t.databaseName)||t.db.createObjectStore(t.databaseName,{keyPath:t.keyPath})}}return J()(E,[{key:"saveDataByKeyPath",value:function(){var s=m()(v()().mark(function r(a,o){var R,n,p,B;return v()().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return R=JSON.stringify(o),n={data:R},n[this.keyPath]=a,P.next=5,this.isHave(a);case 5:p=P.sent,B=this.db.transaction([this.databaseName],"readwrite").objectStore(this.databaseName),p?B.put(n):B.add(n);case 8:case"end":return P.stop()}},r,this)}));function t(r,a){return s.apply(this,arguments)}return t}()},{key:"isHave",value:function(t){var r=this;return new Promise(function(a){var o=r.db.transaction(r.databaseName).objectStore(r.databaseName);o.openCursor().onsuccess=function(R){var n=R.target.result;console.log("cursor",n,t),a(n&&(n==null?void 0:n.primaryKey)===t)}})}},{key:"getAllData",value:function(){var t=this;return new Promise(function(r){var a=[],o=t.db.transaction(t.databaseName).objectStore(t.databaseName);o.openCursor().onsuccess=function(R){var n=R.target.result;if(n){var p=n.value;a.push(JSON.parse(p.data)),n.continue()}else r(a)}})}},{key:"getDataByKeyPath",value:function(t){var r=this;return new Promise(function(a){var o=r.db.transaction([r.databaseName]).objectStore(r.databaseName).get(t);o.onsuccess=function(){console.log("request",o),o!=null&&o.result?a(o==null?void 0:o.result):a(null)}})}},{key:"removeDataByKeyPath",value:function(t){var r=this;return new Promise(function(a){var o=r.db.transaction([r.databaseName],"readwrite").objectStore(r.databaseName).delete(t);o.onsuccess=function(){a(!0)}})}}]),E}(),ee=e(57632),O=function(s,t){return{success:!0,msg:t||"",data:s}},M=function(s){return{success:!1,msg:s||"",data:null}},S=e(14422),i=new K("floorData","floorId"),te=function(s){return new Promise(function(t,r){s.floorId?i.getDataByKeyPath(s.floorId).then(function(a){t(a?O(JSON.parse(a.data)):M(S.Yc.PROMOSE_ERROR_GETBYID_MSG))}):t(M(S.Yc.PROMOSE_ERROR_GETBYID_MSG))})},ae=function(s){return new Promise(function(t,r){var a=(0,ee.Z)();s.name!==void 0&&s.floorIndex!==void 0&&s.url!==void 0?(i.saveDataByKeyPath(a,F()(F()({},s),{},{floorId:a})),t(O({floorId:a},S.Yc.PROMOSE_SUCCESS_MSG))):t(M(S.Yc.PROMOSE_ERROR_MSG))})},ne=function(){var E=m()(v()().mark(function s(t,r){return v()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",new Promise(function(){var R=m()(v()().mark(function n(p,B){return v()().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:try{i.getDataByKeyPath(t).then(function($){i.saveDataByKeyPath(t,F()(F()(F()({},JSON.parse($.data)),r),{},{floorId:t})),p(O(void 0,S.Yc.PROMOSE_SUCCESS_MSG))})}catch($){p(M(S.Yc.PROMOSE_ERROR_MSG))}case 1:case"end":return P.stop()}},n)}));return function(n,p){return R.apply(this,arguments)}}()));case 1:case"end":return o.stop()}},s)}));return function(t,r){return E.apply(this,arguments)}}(),w=function(s){return new Promise(function(){var t=m()(v()().mark(function r(a,o){return v()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:s?i.removeDataByKeyPath(s).then(function(){a(O(void 0,S.Yc.PROMOSE_SUCCESS_MSG))}).catch(function(p){a(M(S.Yc.PROMOSE_ERROR_DELEETE_MSG))}):a(M(S.Yc.PROMOSE_ERROR_ISHAVE_MSG));case 1:case"end":return n.stop()}},r)}));return function(r,a){return t.apply(this,arguments)}}())},I=function(){return new Promise(function(){var s=m()(v()().mark(function t(r,a){var o;return v()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,i.getAllData();case 3:o=n.sent,r(O(o)),n.next=10;break;case 7:n.prev=7,n.t0=n.catch(0),r(M(S.Yc.PROMOSE_ERROR_MSG));case 10:case"end":return n.stop()}},t,null,[[0,7]])}));return function(t,r){return s.apply(this,arguments)}}())}}}]);
