"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[841],{79497:function(U,T,e){e.d(T,{Ae:function(){return O},Lh:function(){return j},QD:function(){return E},Tk:function(){return P},j6:function(){return L},kg:function(){return v}});var p=e(99477),v=new p.YBo({color:14984032}),L=new p.YBo({color:16746384}),E=new p.YBo({color:12763844}),j=new p.YBo({color:13992545}),P=new p.YBo({color:9594235}),O=new p.YBo({color:8751244}),R=function(_){return _[_.chooseStoreMaterial=0]="chooseStoreMaterial",_[_.bindStoreMaterial=1]="bindStoreMaterial",_[_.unBindStoreMaterial=2]="unBindStoreMaterial",_[_.toiletMaterial=3]="toiletMaterial",_[_.liftMaterial=4]="liftMaterial",_[_.floorMaterial=5]="floorMaterial",_}({})},24712:function(U,T,e){e.d(T,{Ah:function(){return C},S1:function(){return c},jG:function(){return m},nS:function(){return t},tf:function(){return a}});var p=e(15009),v=e.n(p),L=e(99289),E=e.n(L),j=e(14422),P=e(99477),O=e(69365),R=e(81764),_=e(79471),r=new P.Pa4(4.422351251620849,-305.6440071261069,645.7196773323486),C,m,y,D,l,b,d,t,a,c=function(){var g=E()(v()().mark(function S(o,n){var s;return v()().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:C=new P.xsS,C.background=new P.Ilk("#e4e4e4"),o&&(m=new P.CP7({canvas:o,antialias:!0,powerPreference:"high-performance"}),m.shadowMap.enabled=!0,m.shadowMap.needsUpdate=!0,m.shadowMap.autoUpdate=!0),D=new _.lX,D.setSize(o.offsetWidth,o.offsetHeight),D.domElement.classList.add("css3d"),a=new R.M,a.setSize(o.offsetWidth,o.offsetHeight),a.domElement.style.position="absolute",a.domElement.style.top="0",a.domElement.style.pointerEvents="none",n&&n.appendChild(a.domElement),m.setSize(o.offsetWidth,o.offsetHeight),t=new P.cPb(45,o.offsetWidth/o.offsetHeight,.2,2e6),t.position.copy(r),s=new P.Pa4,l=new O.z(t,m.domElement),l.addEventListener("start",function(){s.copy(t.position)}),l.addEventListener("end",function(){j.TM.effective=s.distanceToSquared(t.position)===0}),l.addEventListener("change",function(){console.log(t.position)}),i();case 21:case"end":return f.stop()}},S)}));return function(o,n){return g.apply(this,arguments)}}(),i=function(){b=new P.Mig(7368816,3),d=new P.Ox3(16777215,1),d.position.set(1181.4843537287065,1580.039682987524,1809.053759094986),d.castShadow=!0;var S=140;d.shadow.camera.left=-S,d.shadow.camera.right=S,d.shadow.camera.top=S,d.shadow.camera.bottom=-S,d.shadow.camera.near=2,d.shadow.camera.far=10,d.shadow.mapSize.x=102,d.shadow.mapSize.y=102,C.add(d),C.add(b)}},71262:function(U,T,e){e.d(T,{m:function(){return S}});var p=e(15009),v=e.n(p),L=e(64599),E=e.n(L),j=e(99289),P=e.n(j),O=e(61411),R=e(77836),_=e(81367),r=e(99477),C=new O.y,m=new r.dpR,y=new R.E,D=new _.u;function l(n,s){return new Promise(function(h,f){C.load(n,function(u){h(u)},function(u){s&&s(u)})})}function b(n){return new Promise(function(s,h){new OBJLoader().load(n,function(f){s(f)})})}function d(n){return new Promise(function(s,h){m.load(n,function(f){s(f)})})}function t(n){return new Promise(function(s,h){y.load(n,function(f){s(f)})})}function a(n,s){return new Promise(function(h,f){new MTLLoader().load(s,function(u){u.preload(),new OBJLoader().setMaterials(u).load(n,function(M){h(M)})})})}function c(n){return new Promise(function(s,h){D.load(n,function(f){s(f)})})}var i=e(91111),g=e(79497),S=function(){var n=P()(v()().mark(function s(h){var f,u,M,B,I,A,w,K,N,F,Y,W,Z,x,q,Q,H,G,ee,$,X,z,k=arguments;return v()().wrap(function(V){for(;;)switch(V.prev=V.next){case 0:return f=k.length>1&&k[1]!==void 0?k[1]:!1,V.next=3,c(h);case 3:u=V.sent,M=new r.ZAu,B=E()(u.paths);try{for(B.s();!(I=B.n()).done;){A=I.value,w=_.u.createShapes(A),K=E()(w);try{for(K.s();!(N=K.n()).done;){F=N.value,Y=new r.bnF,W=E()(F.curves);try{for(W.s();!(Z=W.n()).done;)for(x=Z.value,q=x.getLength(),Q=x.getPoints(Math.floor(q/20)),H=0;H<Q.length-1;H++)G=Q[H],G.x!==0&&G.x&&G.y!==0&&G.y&&(ee=new r.Pa4(G.x,0,G.y),H===0?Y.moveTo(G.x,G.y):Y.lineTo(G.x,G.y))}catch(J){W.e(J)}finally{W.f()}$=o(F,A.userData.node.id),console.log($.name),$.name==="floor"&&$.isMesh?($.position.z=f?8:-8,$.material=g.Ae):(z=(X=$.userData.box3Info)===null||X===void 0?void 0:X.center,console.log("center",z),$.storeId="".concat(z.x,"_").concat(z.y)),M.add($)}}catch(J){K.e(J)}finally{K.f()}}}catch(J){B.e(J)}finally{B.f()}return V.abrupt("return",M);case 8:case"end":return V.stop()}},s)}));return function(h){return n.apply(this,arguments)}}(),o=function(s,h){var f={depth:h==="floor"?8:(0,i.X)(6,60)},u=new r.O7d(s,f),M=new r.Kj0(u,g.QD.clone());h==="floor"?M.receiveShadow=!0:M.castShadow=!0,M.name=h;var B=(0,i.R)(M);return M.userData.box3Info=B,M}},91111:function(U,T,e){e.d(T,{R:function(){return v},X:function(){return L}});var p=e(99477),v=function(j){if(j.isObject3D){var P=new p.ZzF;P.setFromObject(j);var O=new p.Pa4,R=new p.Pa4;return P.getSize(O),P.getCenter(R),{size:O,center:R,box3:P}}else throw new Error("\u5BF9\u8C61\u9519\u8BEF")};function L(E,j){if(E>=j)throw new Error("min must be less than max");return Math.floor(Math.random()*(j-E+1))+E}},14422:function(U,T,e){e.d(T,{DE:function(){return p},I2:function(){return E},Qt:function(){return P},S$:function(){return L},TM:function(){return _},Yc:function(){return v},ag:function(){return j},cl:function(){return R},qn:function(){return O}});var p="https://three-statices.oss-cn-hangzhou.aliyuncs.com",v=function(r){return r.PROMOSE_ERROR_MSG="\u64CD\u4F5C\u5931\u8D25",r.PROMOSE_SUCCESS_MSG="\u64CD\u4F5C\u6210\u529F",r.PROMOSE_ERROR_DELEETE_MSG="\u64CD\u4F5C\u6210\u529F",r.PROMOSE_ERROR_GETBYID_MSG="\u6807\u8BC6\u4E0D\u5B58\u5728",r.PROMOSE_ERROR_ISHAVE_MSG="\u6570\u636E\u4E0D\u5B58\u5728",r}({}),L=new Map([["floor","\u9910\u996E"],["game","\u5A31\u4E50"],["clothing","\u670D\u88C5"],["education","\u6559\u80B2"],["algo","\u4EBA\u5DE5\u667A\u80FD"],["other","\u5176\u4ED6"]]),E=new Map([["fire","\u6D88\u9632"],["wc","\u536B\u751F\u95F4"],["shops","\u5546\u94FA"],["rest","\u4F11\u606F\u533A"],["visitorCenter","\u6E38\u5BA2\u4E2D\u5FC3"],["parking","\u505C\u8F66\u573A"],["myposition","\u6211\u7684\u4F4D\u7F6E"]]),j=new Map([["fire","/floor-map/icon/xiaofangshuan.png"],["wc","/floor-map/icon/ziyuan.png"],["shops","/floor-map/icon/shangpuzhuanrang-.png"],["rest","/floor-map/icon/xiuxiqu2.png"],["visitorCenter","/floor-map/icon/kefu.png"],["parking","/floor-map/icon/tingchechang.png"]]),P=[{name:"\u95F2\u6797\u57E0",url:"/floor-map/%E8%A5%BF%E5%8D%95%E5%A4%A7%E6%82%A6%E5%9F%8E/F1-01.svg"}],O={rules:[{required:!0,message:"${label}\u5FC5\u586B"}]},R={labelCol:{span:6},wrapperCol:{span:12}},_={effective:!0}},77572:function(U,T,e){var p=e(15009),v=e.n(p),L=e(97857),E=e.n(L),j=e(99289),P=e.n(j),O=e(5574),R=e.n(O),_=e(14422),r=e(23323),C=e(68872),m=e(63620),y=e(5062),D=e(87177),l=e(85893),b=function(t){var a=t.open,c=t.setOpen,i=t.floorId,g=t.pointId,S=t.floorList,o=t.refreshPoint,n=t.lnglat,s=t==null?void 0:t.pointV3,h=r.Z.useForm(),f=R()(h,1),u=f[0],M=function(){c(!1)},B=function(){u.validateFields().then(function(){var A=P()(v()().mark(function w(K){var N,F;return v()().wrap(function(W){for(;;)switch(W.prev=W.next){case 0:return N=E()(E()({pointId:g,position:s},K),{},{lnglat:n}),W.next=3,(0,D.oF)(N);case 3:F=W.sent,F.success&&(C.ZP.success(F.msg),o&&o(i),M());case 5:case"end":return W.stop()}},w)}));return function(w){return A.apply(this,arguments)}}())};return(0,l.jsx)(m.Z,{open:a,onCancel:M,onOk:B,title:"\u70B9\u4F4D\u8BBE\u65BD",children:(0,l.jsxs)(r.Z,E()(E()({form:u},_.cl),{},{children:[(0,l.jsx)(r.Z.Item,E()(E()({label:"\u6240\u5C5E\u666F\u533A"},_.qn),{},{name:"floorId",initialValue:i,children:(0,l.jsx)(y.Z,{disabled:!0,fieldNames:{label:"name",value:"floorId"},options:S})})),(0,l.jsx)(r.Z.Item,E()(E()({label:"\u7C7B\u578B"},_.qn),{},{name:"attribute",children:(0,l.jsx)(y.Z,{options:Array.from(_.I2).map(function(I){return{label:I[1],value:I[0]}})})}))]}))})};T.Z=b},43842:function(U,T,e){var p=e(97857),v=e.n(p),L=e(5574),E=e.n(L),j=e(14422),P=e(93178),O=e(36158),R=e(96638),_=e(23323),r=e(68872),C=e(63620),m=e(98086),y=e(5062),D=e(67294),l=e(85893),b=function(t){var a=t.floorId,c=t.storeId,i=t.open,g=t.setOpen,S=t.floorList,o=t.lnglat;(0,D.useEffect)(function(){c?(s(c),M({storeId:c,title:"\u7F16\u8F91\u5E97\u94FA",isEdit:!0})):(M({storeId:c,title:"\u65B0\u589E\u5E97\u94FA",isEdit:!1}),A.resetFields()),M({open:i})},[i]);var n=(0,O.Z)(P.gX,{manual:!0,onSuccess:function(x){x.success&&A.setFieldsValue(x.data)}}),s=n.run,h=(0,R.Z)({open:!1,title:"\u65B0\u589E\u5E97\u94FA",isEdit:!1}),f=E()(h,2),u=f[0],M=f[1],B=_.Z.useForm(),I=E()(B,1),A=I[0],w=(0,O.Z)(P.up,{manual:!0,onSuccess:function(x){x.success&&(t!=null&&t.refreshStore&&(t==null||t.refreshStore(a)),A.resetFields(),r.ZP.success(x.msg),W())}}),K=w.run,N=(0,O.Z)(P.oQ,{manual:!0,onSuccess:function(x){x.success?(t!=null&&t.refreshStore&&(t==null||t.refreshStore(a)),r.ZP.success(x.msg),W()):r.ZP.error(x.msg)}}),F=N.run,Y=function(){A.validateFields().then(function(x){u.isEdit?F(u.storeId||"",x):t.addId&&K(v()(v()({},x),{},{lnglat:o,storeId:t.addId}))})},W=function(){g(!1),A.resetFields(),t!=null&&t.refreshStore&&(t==null||t.refreshStore(a))};return(0,l.jsx)(C.Z,{open:u.open,onOk:Y,title:u.title,onCancel:W,maskClosable:!1,children:(0,l.jsxs)(_.Z,v()(v()({form:A},j.cl),{},{children:[(0,l.jsx)(_.Z.Item,v()(v()({label:"\u540D\u79F0"},j.qn),{},{name:"name",children:(0,l.jsx)(m.Z,{})})),(0,l.jsx)(_.Z.Item,v()(v()({label:"\u6240\u5C5E\u666F\u533A"},j.qn),{},{name:"floorId",initialValue:a,children:(0,l.jsx)(y.Z,{disabled:!0,fieldNames:{label:"name",value:"floorId"},options:S})})),(0,l.jsx)(_.Z.Item,{label:"\u4E1A\u6001",name:"type",children:(0,l.jsx)(y.Z,{options:Array.from(j.S$).map(function(Z){return{label:Z[1],value:Z[0]}})})}),(0,l.jsx)(_.Z.Item,{label:"\u7F16\u53F7",name:"no",children:(0,l.jsx)(m.Z,{})}),(0,l.jsx)(_.Z.Item,{label:"logo",name:"logo",children:(0,l.jsx)(m.Z,{})})]}))})};T.Z=b},22759:function(U,T,e){var p=e(5574),v=e.n(p),L=e(14422),E=e(93178),j=e(36158),P=e(85265),O=e(45093),R=e(86738),_=e(71230),r=e(15746),C=e(67294),m=e(85893),y=function(l){var b,d=l.open,t=l.setOpen,a=l.storeId,c=l.floorList,i=l.editBtnCallback,g=l.delBtnCallback,S=(0,C.useState)(),o=v()(S,2),n=o[0],s=o[1],h=(0,j.Z)(E.gX,{manual:!0,onSuccess:function(M){M.success&&s(M.data)}}),f=h.run;return(0,C.useEffect)(function(){d&&f(a||"")},[d]),(0,m.jsx)(P.Z,{title:n==null?void 0:n.name,onClose:function(){return t&&t(!1)},open:d,extra:(0,m.jsxs)(m.Fragment,{children:[i&&(0,m.jsx)(O.ZP,{type:"link",onClick:function(){return i&&i()},children:"\u7F16\u8F91"}),g&&(0,m.jsx)(R.Z,{title:"\u5220\u9664\u5E97\u94FA",description:"\u662F\u5426\u5220\u9664\u5E97\u94FA",onConfirm:function(){return g&&g()},okText:"\u662F",cancelText:"\u5426",children:(0,m.jsx)(O.ZP,{type:"link",danger:!0,children:"\u5220\u9664"})})]}),children:(0,m.jsxs)(_.Z,{children:[(0,m.jsx)(r.Z,{span:6,children:(0,m.jsx)("h3",{children:"\u540D\u79F0"})}),(0,m.jsx)(r.Z,{span:18,children:(0,m.jsx)("p",{children:(n==null?void 0:n.name)||"-"})}),(0,m.jsx)(r.Z,{span:6,children:(0,m.jsx)("h3",{children:"\u6240\u5C5E\u666F\u533A"})}),(0,m.jsx)(r.Z,{span:18,children:(0,m.jsx)("p",{children:(c==null||(b=c.find(function(u){return u.floorId===(n==null?void 0:n.floorId)}))===null||b===void 0?void 0:b.name)||"-"})}),(0,m.jsx)(r.Z,{span:6,children:(0,m.jsx)("h3",{children:"\u4E1A\u6001"})}),(0,m.jsx)(r.Z,{span:18,children:(0,m.jsx)("p",{children:L.S$.get((n==null?void 0:n.type)||"")||"-"})}),(0,m.jsx)(r.Z,{span:6,children:(0,m.jsx)("h3",{children:"\u7F16\u53F7"})}),(0,m.jsx)(r.Z,{span:18,children:(0,m.jsx)("p",{children:(n==null?void 0:n.no)||"-"})}),(0,m.jsx)(r.Z,{span:6,children:(0,m.jsx)("h3",{children:"logo"})}),(0,m.jsx)(r.Z,{span:18,children:n!=null&&n.logo?(0,m.jsx)("img",{style:{width:64,height:64},src:n==null?void 0:n.logo,alt:""}):"-"})]})})};T.Z=y},46500:function(U,T,e){e.d(T,{BG:function(){return m},RT:function(){return l},TW:function(){return D},jl:function(){return b},wA:function(){return y}});var p=e(15009),v=e.n(p),L=e(99289),E=e.n(L),j=e(97857),P=e.n(j),O=e(31065),R=e(57632),_=e(20701),r=e(14422),C=new O.y("floorData","floorId"),m=function(t){return new Promise(function(a,c){t.floorId?C.getDataByKeyPath(t.floorId).then(function(i){a(i?(0,_.Em)(JSON.parse(i.data)):(0,_.Z5)(r.Yc.PROMOSE_ERROR_GETBYID_MSG))}):a((0,_.Z5)(r.Yc.PROMOSE_ERROR_GETBYID_MSG))})},y=function(t){return new Promise(function(a,c){var i=(0,R.Z)();t.name!==void 0&&t.floorIndex!==void 0&&t.url!==void 0?(C.saveDataByKeyPath(i,P()(P()({},t),{},{floorId:i})),a((0,_.Em)({floorId:i},r.Yc.PROMOSE_SUCCESS_MSG))):a((0,_.Z5)(r.Yc.PROMOSE_ERROR_MSG))})},D=function(){var d=E()(v()().mark(function t(a,c){return v()().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.abrupt("return",new Promise(function(){var S=E()(v()().mark(function o(n,s){return v()().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:try{C.getDataByKeyPath(a).then(function(u){C.saveDataByKeyPath(a,P()(P()({},JSON.parse(u.data)),c)),n((0,_.Em)(void 0,r.Yc.PROMOSE_SUCCESS_MSG))})}catch(u){n((0,_.Z5)(r.Yc.PROMOSE_ERROR_MSG))}case 1:case"end":return f.stop()}},o)}));return function(o,n){return S.apply(this,arguments)}}()));case 1:case"end":return g.stop()}},t)}));return function(a,c){return d.apply(this,arguments)}}(),l=function(t){return new Promise(function(){var a=E()(v()().mark(function c(i,g){return v()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:t?C.removeDataByKeyPath(t).then(function(){i((0,_.Em)(void 0,r.Yc.PROMOSE_SUCCESS_MSG))}).catch(function(n){i((0,_.Z5)(r.Yc.PROMOSE_ERROR_DELEETE_MSG))}):i((0,_.Z5)(r.Yc.PROMOSE_ERROR_ISHAVE_MSG));case 1:case"end":return o.stop()}},c)}));return function(c,i){return a.apply(this,arguments)}}())},b=function(){return new Promise(function(){var t=E()(v()().mark(function a(c,i){var g;return v()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.prev=0,o.next=3,C.getAllData();case 3:g=o.sent,c((0,_.Em)(g)),o.next=10;break;case 7:o.prev=7,o.t0=o.catch(0),c((0,_.Z5)(r.Yc.PROMOSE_ERROR_MSG));case 10:case"end":return o.stop()}},a,null,[[0,7]])}));return function(a,c){return t.apply(this,arguments)}}())}},20701:function(U,T,e){e.d(T,{Em:function(){return j},Z5:function(){return P}});var p=e(5574),v=e.n(p),L=e(97857),E=e.n(L),j=function(r,C){return{success:!0,msg:C||"",data:r}},P=function(r){return{success:!1,msg:r||"",data:null}},O=function(r,C){var m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},y=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{},D=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{},l=new URLSearchParams(D).toString();return console.log("queryString",l),new Promise(function(b,d){fetch("".concat(r).concat(l?"?"+l:""),{method:C||"POST",headers:_objectSpread(_objectSpread({},m),{},{Accept:"text/event-stream"}),body:JSON.stringify(y||{})}).finally(function(){console.log(123)}).then(function(t){if(!t.ok)throw new Error("Network response was not ok");return t.text()}).then(function(t){console.log("eventStreamData",t)}).catch(function(t){d(t),console.error("There was a problem with your fetch operation:",t)})})};function R(_){var r=_.trim().split(`
`),C=null;if(r.forEach(function(y){var D=y.split(":"),l=_slicedToArray(D,2),b=l[0],d=l[1];b.trim()==="data"&&(C=d.trim().replace(/\\/g,""))}),C)try{var m=JSON.parse(C);return console.log(m),m}catch(y){console.error("Failed to parse JSON:",y)}return null}},87177:function(U,T,e){e.d(T,{Wh:function(){return b},oF:function(){return C}});var p=e(15009),v=e.n(p),L=e(97857),E=e.n(L),j=e(99289),P=e.n(j),O=e(31065),R=e(20701),_=e(14422),r=new O.y("pointData","pointId"),C=function(t){return new Promise(function(a,c){r.saveDataByKeyPath(t.pointId,t),a((0,R.Em)({id:t.pointId},_.Yc.PROMOSE_SUCCESS_MSG))})},m=function(t){return new Promise(function(a,c){t?r.getDataByKeyPath(t).then(function(i){a(i?theSuccess(JSON.parse(i.data)):theError(PROMOSE_RESPONSE.PROMOSE_ERROR_GETBYID_MSG))}):a(theError(PROMOSE_RESPONSE.PROMOSE_ERROR_GETBYID_MSG))})},y=null,D=function(t){return new Promise(function(){var a=_asyncToGenerator(_regeneratorRuntime().mark(function c(i,g){return _regeneratorRuntime().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:t?r.removeDataByKeyPath(t).then(function(){i(theSuccess(void 0,PROMOSE_RESPONSE.PROMOSE_SUCCESS_MSG))}).catch(function(n){i(theError(PROMOSE_RESPONSE.PROMOSE_ERROR_DELEETE_MSG))}):i(theError(PROMOSE_RESPONSE.PROMOSE_ERROR_ISHAVE_MSG));case 1:case"end":return o.stop()}},c)}));return function(c,i){return a.apply(this,arguments)}}())},l=function(){return new Promise(function(){var t=_asyncToGenerator(_regeneratorRuntime().mark(function a(c,i){var g;return _regeneratorRuntime().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.prev=0,o.next=3,r.getAllData();case 3:g=o.sent,c(theSuccess(g)),o.next=10;break;case 7:o.prev=7,o.t0=o.catch(0),c(theError(PROMOSE_RESPONSE.PROMOSE_ERROR_MSG));case 10:case"end":return o.stop()}},a,null,[[0,7]])}));return function(a,c){return t.apply(this,arguments)}}())},b=function(t){return new Promise(function(){var a=P()(v()().mark(function c(i,g){var S;return v()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,r.getAllData("floorId",t);case 3:S=n.sent,i((0,R.Em)(S)),n.next=10;break;case 7:n.prev=7,n.t0=n.catch(0),i((0,R.Z5)(_.Yc.PROMOSE_ERROR_MSG));case 10:case"end":return n.stop()}},c,null,[[0,7]])}));return function(c,i){return a.apply(this,arguments)}}())}},93178:function(U,T,e){e.d(T,{Ev:function(){return b},HC:function(){return D},gX:function(){return m},oQ:function(){return y},up:function(){return C}});var p=e(15009),v=e.n(p),L=e(97857),E=e.n(L),j=e(99289),P=e.n(j),O=e(31065),R=e(20701),_=e(14422),r=new O.y("storeData","storeId"),C=function(t){return new Promise(function(a,c){r.saveDataByKeyPath(t.storeId,t),a((0,R.Em)({storeId:t.storeId},_.Yc.PROMOSE_SUCCESS_MSG))})},m=function(t){return new Promise(function(a,c){t?r.getDataByKeyPath(t).then(function(i){a(i?(0,R.Em)(JSON.parse(i.data)):(0,R.Z5)(_.Yc.PROMOSE_ERROR_GETBYID_MSG))}):a((0,R.Z5)(_.Yc.PROMOSE_ERROR_GETBYID_MSG))})},y=function(){var d=P()(v()().mark(function t(a,c){return v()().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.abrupt("return",new Promise(function(){var S=P()(v()().mark(function o(n,s){return v()().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:try{r.getDataByKeyPath(a).then(function(u){console.log("oldData",u),r.saveDataByKeyPath(a,E()(E()(E()({},JSON.parse((u==null?void 0:u.data)||"{}")),c),{},{storeId:a})),n((0,R.Em)(void 0,_.Yc.PROMOSE_SUCCESS_MSG))})}catch(u){n((0,R.Z5)(_.Yc.PROMOSE_ERROR_MSG))}case 1:case"end":return f.stop()}},o)}));return function(o,n){return S.apply(this,arguments)}}()));case 1:case"end":return g.stop()}},t)}));return function(a,c){return d.apply(this,arguments)}}(),D=function(t){return new Promise(function(){var a=P()(v()().mark(function c(i,g){return v()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:t?r.removeDataByKeyPath(t).then(function(){i((0,R.Em)(void 0,_.Yc.PROMOSE_SUCCESS_MSG))}).catch(function(n){i((0,R.Z5)(_.Yc.PROMOSE_ERROR_DELEETE_MSG))}):i((0,R.Z5)(_.Yc.PROMOSE_ERROR_ISHAVE_MSG));case 1:case"end":return o.stop()}},c)}));return function(c,i){return a.apply(this,arguments)}}())},l=function(){return new Promise(function(){var t=_asyncToGenerator(_regeneratorRuntime().mark(function a(c,i){var g;return _regeneratorRuntime().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.prev=0,o.next=3,r.getAllData();case 3:g=o.sent,c(theSuccess(g)),o.next=10;break;case 7:o.prev=7,o.t0=o.catch(0),c(theError(PROMOSE_RESPONSE.PROMOSE_ERROR_MSG));case 10:case"end":return o.stop()}},a,null,[[0,7]])}));return function(a,c){return t.apply(this,arguments)}}())},b=function(t){return new Promise(function(){var a=P()(v()().mark(function c(i,g){var S;return v()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,r.getAllData("floorId",t);case 3:S=n.sent,i((0,R.Em)(S)),n.next=10;break;case 7:n.prev=7,n.t0=n.catch(0),i((0,R.Z5)(_.Yc.PROMOSE_ERROR_MSG));case 10:case"end":return n.stop()}},c,null,[[0,7]])}));return function(c,i){return a.apply(this,arguments)}}())}},3682:function(U,T,e){e.d(T,{u4:function(){return b},E5:function(){return o},uz:function(){return d},fJ:function(){return a}});var p=e(67294),v=e(5574),L=e.n(v),E=e(14422),j=e(68872),P=e(63620),O=e(85893),R=function(s){var h=s==null?void 0:s.logo,f=s==null?void 0:s.name,u=s==null?void 0:s.markData,M=s==null?void 0:s.callback,B=function(){console.log(u),j.ZP.success(u.name||E.I2.get(u.attribute)),u.name&&M&&M({type:"name",value:u.name}),u.attribute!=="myperson"&&F(!0)},I=function(){F(!1)},A=function(){I(),M&&M({type:"nav",value:u.lnglat})},w=(0,p.useState)(!1),K=L()(w,2),N=K[0],F=K[1];return(0,O.jsxs)(O.Fragment,{children:[(0,O.jsxs)("div",{className:"bind-store",onClick:B,children:[(0,O.jsx)("div",{className:"img-main",children:(0,O.jsx)("img",{src:h,alt:""})}),(0,O.jsx)("p",{children:f})]}),(0,O.jsxs)(P.Z,{okText:"\u5BFC\u822A\u5230\u8FD9\u91CC",onCancel:I,onOk:A,open:N,title:"\u8BE6\u60C5",children:[(0,O.jsxs)("p",{children:["\u5F53\u524D\u76EE\u6807\u4E3A",(0,O.jsx)("span",{style:{color:"green"},children:u.name||E.I2.get(u.attribute)})]}),(0,O.jsxs)("p",{children:["\u5F53\u524D\u76EE\u6807\u4F4D\u7F6E\u4E3A",(0,O.jsx)("span",{style:{color:"green"},children:(u.lnglat||[]).join("\uFF0C")})]}),(0,O.jsx)("p",{children:"\u53EF\u4EE5\u518D\u6B21\u8FDE\u63A5\u667A\u6167\u8BBE\u65BD\uFF0C\u6BD4\u5982\u667A\u6167\u516C\u6D4B\uFF0C\u667A\u80FD\u6D88\u9632\uFF0C\u667A\u80FD\u6444\u50CF\u5934\u7B49\u76D1\u63A7\u8BBE\u5907"}),(0,O.jsx)("p",{children:"\u4E5F\u53EF\u4EE5\u4ECE\u6A21\u62DF\u7684\u6211\u7684\u4F4D\u7F6E\u5BFC\u822A\u5230\u8FD9\u4E2A\u4F4D\u7F6E\uFF1A"})]})]})},_=R,r=e(79497),C=e(24712),m=e(91111),y=e(99477),D=e(81764),l=e(73935),b=function(s,h){var f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:C.Ah,u=arguments.length>3?arguments[3]:void 0;h.traverse(function(B){if(B){var I=B.name.split("_")[0];B.material=t(I)}});var M=new y.ZAu;f.add(M),s.forEach(function(B){var I=B.storeId;if(I){var A=f.getObjectByProperty("storeId",I);if(A){A.material=r.j6.clone(),A.storeType="bind",A.userData.storeInfo=B;var w=(0,m.R)(A).center;if(u)u(B);else{var K=c(B,w,B);M.add(K)}}}})},d=function(s){var h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:C.Ah,f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:new y.Pa4;s.forEach(function(u){var M=i(u);M.position.add(f),h.add(M)})},t=function(s){switch(s){case"bind":return r.j6.clone();case"unBind":return r.QD.clone();case"toilet":return r.Lh.clone();case"lift":return r.Tk.clone();case"Escalator":return r.Tk.clone();case"choose":return r.kg.clone();case"floor":return r.Ae.clone();default:return r.QD.clone()}};function a(n){for(var s=0,h=0;n&&!isNaN(n.offsetLeft);)s+=n.offsetLeft-n.scrollLeft,h+=n.offsetTop-n.scrollTop,n=n.offsetParent;return{left:s,top:h}}var c=function(s,h,f,u){var M=document.createElement("div"),B=l.createRoot(M);B.render((0,O.jsx)(_,{logo:(s==null?void 0:s.logo)||"".concat(E.DE).concat(E.ag.get("shops")),name:s.name,markData:f,callback:u}));var I=new D.j(M);return I.position.copy(h),I},i=function(s){var h=document.createElement("div"),f=l.createRoot(h);f.render((0,O.jsx)(_,{logo:"".concat(E.DE).concat(E.ag.get(s.attribute))}));var u=new D.j(h),M=new y.Pa4().fromArray(s.position);return u.position.copy(M),u},g=function(s,h,f){var u=s.clone(),M=u.project(f),B=window.innerWidth/2,I=window.innerHeight/2,A=Math.round(M.x*B+B),w=Math.round(-M.y*I+I),K=new THREE.Vector2(A,w);return h.copy(K),K},S=function(s,h,f,u){var M=s.x,B=s.y,I=new h.Pixel(M,B),A=f.containerToLngLat(I),w=new THREE.Vector2;return w.set(A.lng,A.lat),u!=null&&u.isVector2&&u.copy(w),w},o=function(s,h,f,u,M){if(s){var B=new h.LngLat(u.lnglat[0],u.lnglat[1]),I=document.createElement("div"),A=l.createRoot(I);A.render((0,O.jsx)(_,{logo:f.iconUrl,name:f==null?void 0:f.name,markData:u,callback:M}));var w=new h.Marker({position:B,content:I,offset:new h.Pixel(-13,-30)});s.add(w)}}},31065:function(U,T,e){e.d(T,{y:function(){return C}});var p=e(15009),v=e.n(p),L=e(99289),E=e.n(L),j=e(12444),P=e.n(j),O=e(72004),R=e.n(O),_=e(9783),r=e.n(_),C=function(){function m(y){var D=this,l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"id";P()(this,m),r()(this,"databaseName",void 0),r()(this,"db",void 0),r()(this,"isOpen",!1),r()(this,"keyPath",void 0),this.databaseName=y,this.keyPath=l;var b=window.indexedDB.open(this.databaseName);b.onerror=function(){console.log("\u6570\u636E\u5E93\u6253\u5F00\u62A5\u9519"),D.isOpen=!1},b.onsuccess=function(){D.db=b.result,console.log("\u6570\u636E\u5E93\u6253\u5F00\u6210\u529F"),D.isOpen=!0},b.onupgradeneeded=function(d){D.db=d.target.result,D.db.objectStoreNames.contains(D.databaseName)||D.db.createObjectStore(D.databaseName,{keyPath:D.keyPath})}}return R()(m,[{key:"saveDataByKeyPath",value:function(){var y=E()(v()().mark(function l(b,d){var t,a,c,i;return v()().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return t=JSON.stringify(d),a={data:t},a[this.keyPath]=b,S.next=5,this.isHave(b);case 5:c=S.sent,i=this.db.transaction([this.databaseName],"readwrite").objectStore(this.databaseName),console.log("store",i,a),c?i.put(a):i.add(a);case 9:case"end":return S.stop()}},l,this)}));function D(l,b){return y.apply(this,arguments)}return D}()},{key:"isHave",value:function(D){var l=this;return new Promise(function(b){var d=l.db.transaction(l.databaseName).objectStore(l.databaseName);d.openCursor().onsuccess=function(t){var a=t.target.result;console.log("cursor",a,D),b(a&&(a==null?void 0:a.primaryKey)===D)}})}},{key:"getAllData",value:function(D,l){var b=this;return new Promise(function(d){var t=[],a=b.db.transaction(b.databaseName).objectStore(b.databaseName);a.openCursor().onsuccess=function(c){var i=c.target.result;if(i){var g=i.value,S=JSON.parse(g.data);D&&l!==void 0?S[D]===l&&t.push(S):t.push(S),i.continue()}else d(t)}})}},{key:"getDataByKeyPath",value:function(D){var l=this;return new Promise(function(b){var d=l.db.transaction([l.databaseName]).objectStore(l.databaseName).get(D);d.onsuccess=function(){d!=null&&d.result?b(d==null?void 0:d.result):b(null)}})}},{key:"removeDataByKeyPath",value:function(D){var l=this;return new Promise(function(b){var d=l.db.transaction([l.databaseName],"readwrite").objectStore(l.databaseName).delete(D);d.onsuccess=function(){b(!0)}})}}]),m}()}}]);
