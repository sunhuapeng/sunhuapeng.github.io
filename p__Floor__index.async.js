"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[396],{14422:function(Q,j,e){e.d(j,{DE:function(){return x},Qt:function(){return S},Yc:function(){return c},uV:function(){return Z}});var x="https://three-statices.oss-cn-hangzhou.aliyuncs.com/",c=function(g){return g.PROMOSE_ERROR_MSG="\u64CD\u4F5C\u5931\u8D25",g.PROMOSE_SUCCESS_MSG="\u64CD\u4F5C\u6210\u529F",g.PROMOSE_ERROR_DELEETE_MSG="\u64CD\u4F5C\u6210\u529F",g.PROMOSE_ERROR_GETBYID_MSG="\u6807\u8BC6\u4E0D\u5B58\u5728",g.PROMOSE_ERROR_ISHAVE_MSG="\u6570\u636E\u4E0D\u5B58\u5728",g}({}),Z=[{label:"\u9910\u996E",value:"floor"},{label:"\u5A31\u4E50",value:"game"},{label:"\u670D\u88C5",value:"clothing"},{label:"\u6559\u80B2",value:"education"},{label:"\u4EBA\u5DE5\u667A\u80FD",value:"algo"},{label:"\u5176\u4ED6",value:"other"}],S=[{name:"F1",url:"floor-map/%E8%A5%BF%E5%8D%95%E5%A4%A7%E6%82%A6%E5%9F%8E/F1.svg"}]},34368:function(Q,j,e){e.r(j),e.d(j,{default:function(){return y}});var x=e(15009),c=e.n(x),Z=e(99289),S=e.n(Z),g=e(5574),F=e.n(g),b=e(90930),Y={container:"container___Nrkw8",floorList:"floorList___QGLBe"},R=e(68872),P=e(27494),L=e(63620),O=e(98086),K=e(10418),$=e(5062),p=e(78957),v=e(45093),h=e(4393),E=e(86738),B=e(61781),H=e(26412),U=e(32983),D=e(32774),M=e(67294),d=e(27704),o=e(36531),t=e(29158),a=e(577),r=e(80854),u=e(14422),n=e(85893),s=function(){var J=(0,M.useState)(""),m=F()(J,2),V=m[0],he=m[1],q=function(){var i=S()(c()().mark(function l(I){var C;return c()().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,(0,D.wA)(I);case 2:C=f.sent,C.success?(R.ZP.success(C.msg),z()):R.ZP.error(C.msg);case 4:case"end":return f.stop()}},l)}));return function(I){return i.apply(this,arguments)}}(),_=(0,a.Z)(D.jl,{manual:!1,debounceWait:300,onSuccess:function(l){l.success&&se(l.data)}}),z=_.run,ee=(0,a.Z)(D.RT,{manual:!0,onSuccess:function(l){l.success?(z(),R.ZP.success(l.msg)):R.ZP.error(l.msg)}}),te=ee.run,ne=(0,a.Z)(D.TW,{manual:!0,onSuccess:function(l){l.success?(R.ZP.success(l.msg),T({open:!1,isEdit:!1}),z()):R.ZP.error(l.msg)}}),ae=ne.run,re=(0,M.useState)([]),W=F()(re,2),w=W[0],se=W[1],oe=(0,M.useState)({open:!1,title:"\u65B0\u589E\u697C\u5C42",floorData:{}}),k=F()(oe,2),N=k[0],T=k[1],ue=P.Z.useForm(),le=F()(ue,1),A=le[0],ie=function(){T({open:!0,title:"\u65B0\u589E\u697C\u5C42",isEdit:!1})},ce=function(){A.validateFields().then(function(){var l=S()(c()().mark(function I(C){return c()().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(!N.isEdit){f.next=5;break}return f.next=3,ae(N.editFloorId||"",C);case 3:f.next=7;break;case 5:return f.next=7,q(C);case 7:X();case 8:case"end":return f.stop()}},I)}));return function(I){return l.apply(this,arguments)}}())},X=function(){A.resetFields(),T({open:!1})},de=function(l){T({open:!0,isEdit:!0,editFloorId:l.floorId||"",title:"\u7F16\u8F91\u697C\u5C42"}),A.setFieldsValue(l)},fe=function(l){r.history.push("/store-model/".concat(l))};return(0,n.jsxs)(b._z,{ghost:!0,children:[(0,n.jsx)(L.Z,{title:N.title,open:N.open,onOk:ce,onCancel:X,children:(0,n.jsxs)(P.Z,{form:A,labelCol:{span:4},wrapperCol:{span:12},children:[(0,n.jsx)(P.Z.Item,{label:"\u697C\u5C42\u540D\u79F0",name:"name",children:(0,n.jsx)(O.Z,{})}),(0,n.jsx)(P.Z.Item,{label:"\u697C\u5C42\u7D22\u5F15",name:"floorIndex",children:(0,n.jsx)(K.Z,{step:"1"})}),(0,n.jsx)(P.Z.Item,{label:"\u6A21\u578B\u8DEF\u5F84",name:"url",children:(0,n.jsx)($.Z,{options:u.Qt,fieldNames:{label:"name",value:"url"}})})]})}),(0,n.jsx)(p.Z,{children:(0,n.jsx)(v.ZP,{type:"primary",onClick:ie,children:"\u65B0\u589E\u697C\u5C42"})}),(0,n.jsx)("div",{className:Y.floorList,children:w.length!==0?w.map(function(i){return(0,n.jsx)(h.Z,{size:"small",title:i.name,extra:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(E.Z,{title:"\u5220\u9664\u697C\u5C42",description:"\u662F\u5426\u5220\u9664\u697C\u5C42",onConfirm:function(){return te((i==null?void 0:i.floorId)||"")},okText:"\u662F",cancelText:"\u5426",children:(0,n.jsx)(B.Z,{title:"\u5220\u9664",children:(0,n.jsx)(v.ZP,{danger:!0,icon:(0,n.jsx)(d.Z,{}),type:"link"})})}),(0,n.jsx)(B.Z,{title:"\u7F16\u8F91",children:(0,n.jsx)(v.ZP,{icon:(0,n.jsx)(o.Z,{}),onClick:function(){return de(i)},type:"link"})}),(0,n.jsx)(B.Z,{title:"\u67E5\u770B",children:(0,n.jsx)(v.ZP,{icon:(0,n.jsx)(t.Z,{}),onClick:function(){return fe(i.floorId||"")},type:"link"})})]}),style:{width:300},children:(0,n.jsx)(H.Z,{items:[{key:"Descriptions"+i.floorIndex,label:"\u697C\u5C42\u7D22\u5F15",children:(0,n.jsx)("p",{children:i.floorIndex})},{key:"Descriptions"+i.storeCount,label:"\u5546\u94FA\u6570\u91CF",children:(0,n.jsx)("p",{children:i.storeCount||0})}]})},i.floorId)}):(0,n.jsx)(U.Z,{})})]})},y=s},32774:function(Q,j,e){e.d(j,{wA:function(){return H},jl:function(){return M},BG:function(){return B},RT:function(){return D},TW:function(){return U}});var x=e(15009),c=e.n(x),Z=e(99289),S=e.n(Z),g=e(97857),F=e.n(g),b=e(12444),Y=e.n(b),R=e(72004),P=e.n(R),L=e(9783),O=e.n(L),K=function(){function d(o){var t=this,a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"id";Y()(this,d),O()(this,"databaseName",void 0),O()(this,"db",void 0),O()(this,"isOpen",!1),O()(this,"keyPath",void 0),this.databaseName=o,this.keyPath=a;var r=window.indexedDB.open(this.databaseName);r.onerror=function(){console.log("\u6570\u636E\u5E93\u6253\u5F00\u62A5\u9519"),t.isOpen=!1},r.onsuccess=function(){t.db=r.result,console.log("\u6570\u636E\u5E93\u6253\u5F00\u6210\u529F"),t.isOpen=!0},r.onupgradeneeded=function(u){t.db=u.target.result,t.db.objectStoreNames.contains(t.databaseName)||t.db.createObjectStore(t.databaseName,{keyPath:t.keyPath})}}return P()(d,[{key:"saveDataByKeyPath",value:function(){var o=S()(c()().mark(function a(r,u){var n,s,y,G;return c()().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return n=JSON.stringify(u),s={data:n},s[this.keyPath]=r,m.next=5,this.isHave(r);case 5:y=m.sent,G=this.db.transaction([this.databaseName],"readwrite").objectStore(this.databaseName),y?G.put(s):G.add(s);case 8:case"end":return m.stop()}},a,this)}));function t(a,r){return o.apply(this,arguments)}return t}()},{key:"isHave",value:function(t){var a=this;return new Promise(function(r){var u=a.db.transaction(a.databaseName).objectStore(a.databaseName);u.openCursor().onsuccess=function(n){var s=n.target.result;console.log("cursor",s,t),r(s&&(s==null?void 0:s.primaryKey)===t)}})}},{key:"getAllData",value:function(){var t=this;return new Promise(function(a){var r=[],u=t.db.transaction(t.databaseName).objectStore(t.databaseName);u.openCursor().onsuccess=function(n){var s=n.target.result;if(s){var y=s.value;r.push(JSON.parse(y.data)),s.continue()}else a(r)}})}},{key:"getDataByKeyPath",value:function(t){var a=this;return new Promise(function(r){var u=a.db.transaction([a.databaseName]).objectStore(a.databaseName).get(t);u.onsuccess=function(){console.log("request",u),u!=null&&u.result?r(u==null?void 0:u.result):r(null)}})}},{key:"removeDataByKeyPath",value:function(t){var a=this;return new Promise(function(r){var u=a.db.transaction([a.databaseName],"readwrite").objectStore(a.databaseName).delete(t);u.onsuccess=function(){r(!0)}})}}]),d}(),$=e(57632),p=function(o,t){return{success:!0,msg:t||"",data:o}},v=function(o){return{success:!1,msg:o||"",data:null}},h=e(14422),E=new K("floorData","floorId"),B=function(o){return new Promise(function(t,a){o.floorId?E.getDataByKeyPath(o.floorId).then(function(r){t(r?p(JSON.parse(r.data)):v(h.Yc.PROMOSE_ERROR_GETBYID_MSG))}):t(v(h.Yc.PROMOSE_ERROR_GETBYID_MSG))})},H=function(o){return new Promise(function(t,a){var r=(0,$.Z)();o.name!==void 0&&o.floorIndex!==void 0&&o.url!==void 0?(E.saveDataByKeyPath(r,F()(F()({},o),{},{floorId:r})),t(p({floorId:r},h.Yc.PROMOSE_SUCCESS_MSG))):t(v(h.Yc.PROMOSE_ERROR_MSG))})},U=function(){var d=S()(c()().mark(function o(t,a){return c()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",new Promise(function(){var n=S()(c()().mark(function s(y,G){return c()().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:try{E.getDataByKeyPath(t).then(function(V){E.saveDataByKeyPath(t,F()(F()(F()({},JSON.parse(V.data)),a),{},{floorId:t})),y(p(void 0,h.Yc.PROMOSE_SUCCESS_MSG))})}catch(V){y(v(h.Yc.PROMOSE_ERROR_MSG))}case 1:case"end":return m.stop()}},s)}));return function(s,y){return n.apply(this,arguments)}}()));case 1:case"end":return u.stop()}},o)}));return function(t,a){return d.apply(this,arguments)}}(),D=function(o){return new Promise(function(){var t=S()(c()().mark(function a(r,u){return c()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:o?E.removeDataByKeyPath(o).then(function(){r(p(void 0,h.Yc.PROMOSE_SUCCESS_MSG))}).catch(function(y){r(v(h.Yc.PROMOSE_ERROR_DELEETE_MSG))}):r(v(h.Yc.PROMOSE_ERROR_ISHAVE_MSG));case 1:case"end":return s.stop()}},a)}));return function(a,r){return t.apply(this,arguments)}}())},M=function(){return new Promise(function(){var o=S()(c()().mark(function t(a,r){var u;return c()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.prev=0,s.next=3,E.getAllData();case 3:u=s.sent,a(p(u)),s.next=10;break;case 7:s.prev=7,s.t0=s.catch(0),a(v(h.Yc.PROMOSE_ERROR_MSG));case 10:case"end":return s.stop()}},t,null,[[0,7]])}));return function(t,a){return o.apply(this,arguments)}}())}}}]);
